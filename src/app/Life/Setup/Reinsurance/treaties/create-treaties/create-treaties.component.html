<loader [loading]="loading" text="{{loadingText}}" class="vh-80">
  <!-- <app-form-navigation [title]="'Set Up / Reinsurance / Treaties  '"></app-form-navigation> -->

  <div class="container">
    <br />
    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Treaty Code"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.code" disabled
          class="form-control form-control-sm control-bg-gray" />
      </div>
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Description"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.description" name="description" required
          class="form-control form-control-sm control-bg-gray" />
      </div>
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Profit Sharing Code"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.profitSharingCode" name="profitSharingTable" required
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of profitSharingList" value="{{ item.code }}">
            {{ item.code }} - {{ item.description }}
          </option>
        </select>
      </div>


    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Commission Basis"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.reinsCommBasis" name="reinsCommBasis" required
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of reinCommBasis" value="{{ item.code }}">
            {{ item.code }} - {{ item.title }}
          </option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Retention Limit"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.retention" name="retention" required type="number" min="1"
          class="form-control form-control-sm control-bg-gray" />
      </div>
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Commission Table"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.reinsCommTable" name="reinsCommTable" required
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of reinsCommTable" value="{{ item.code }}">
            {{ item.code }} - {{ item.description }}
          </option>
        </select>
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Treaty Group"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.treatyGroup" name="treatyGroup" required id=""
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of treatyGroup" value="{{ item.code }}">
            {{ item.code }} - {{ item.title }}
          </option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Catastrophic Event Limit"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.catEventLimit" name="catEventLimit" type="number"
          class="form-control form-control-sm control-bg-gray" />
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Claim Cash Call "|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.claimCashCall" name="claimCashCall" type="number"
          class="form-control form-control-sm control-bg-gray" />
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Treaty Category"|appTranslate|async}}</label>
        <select name="treatyCategory" [(ngModel)]="reinsuranceData.treaty.category" required id=""
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of treatyCategory" value="{{ item.code }}">
            {{ item.code }} - {{ item.title }}
          </option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Declared Premium Amount"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.declaredPremium" name="declaredPremium" required type="number"
          min="1" class="form-control form-control-sm control-bg-gray" />
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance SAR Basis"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.sarBasis" name="sarBasis" required type="text"
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of sarBasis" value="{{ item.code }}">
            {{ item.code }} - {{ item.title }}
          </option>
        </select>
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Treaty Date Basis"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.treatyDateBasis" name="treatyDateBasis" required id=""
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of treatyDateBasis" value="{{ item.code }}">
            {{ item.code }} - {{ item.title }}
          </option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Actual Premium Amount for the year"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.actualPremium" name="actualPremium" type="number"
          class="form-control form-control-sm control-bg-gray" />
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Company"|appTranslate|async}}</label>
        <select name="company" [(ngModel)]="reinsuranceData.treaty.reinsCompany" required
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of company" value="{{ item.code }}">
            {{ item.code }} - {{ item.description }}
          </option>
        </select>
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Commission Rate (%)"|appTranslate|async}}</label>
        <input [(ngModel)]="reinsuranceData.treaty.reinsCommRate" type="number" min="1" name="reinsCommRate" required
          class="form-control form-control-sm control-bg-gray" />
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Premium Basis"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.reinsPremBasis" name="reinsPremBasis" required
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of reinsPremBasis" value="{{ item.code }}">
            {{ item.code }} - {{ item.title }}
          </option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Premium Table"|appTranslate|async}}</label>
        <select [(ngModel)]="reinsuranceData.treaty.reinsPremTable" name="reinsPremTable" required
          class="form-control form-control-sm control-bg-gray">
          <option *ngFor="let item of reinsPremTable" value="{{ item.code }}">
            {{ item.code }} - {{ item.description }}
          </option>
        </select>
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Treaty Start Date "|appTranslate|async}}</label>
        <input (input)="reinsuranceData.treaty.treatyStartDate =treatyStartDate.value" #treatyStartDate
          [value]="reinsuranceData.treaty.treatyStartDate | date:'yyyy-MM-dd'" name="treatyStartDate" required
          type="date" class="form-control form-control-sm control-bg-gray" />
      </div>
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Treaty End Date "|appTranslate|async}}</label>
        <input (input)="reinsuranceData.treaty.treatyEndDate = treatyEndDate.value" #treatyEndDate
          [value]="reinsuranceData.treaty.treatyEndDate | date:'yyyy-MM-dd'" name="treatyEndDate" type="date" required
          class="form-control form-control-sm control-bg-gray" />
      </div>
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Reinsurance Premium Rate (%) "|appTranslate|async}}</label>
        <input type="number" [(ngModel)]="reinsuranceData.treaty.reinsPremRate"
          class="form-control form-control-sm control-bg-gray" />
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-md-4">
        <label class="form-label text-primary">{{"Quota Share Proportion to Reinsurer(%)"|appTranslate|async}}</label>
        <input type="number" class="form-control form-control-sm control-bg-gray">
      </div>
    </div>
    <div class="row mt-2 justify-content-center">
      <div class="col-md-4">
        <label class="form-label text-primary w-100 text-center">
          Reverse Reinsurance on Lapse or Surrender
        </label>
        <input [(ngModel)]="reinsuranceData.treaty.reverseReinsLapseSurr" name="reverseReinsLapseSurr" required
          type="checkbox" class="form-control control-bg-gray mx-auto" />
      </div>

    </div>
    <div class="row mt-2">
      <div class="col-md-3">
        <label class="form-label text-primary">&nbsp;</label>
        <app-button buttonType="default" text="Reinsurance Broker" data-bs-toggle="modal"
          data-bs-target="#ReinsuranceBroker"></app-button>
      </div>
      <div class="col-md-3">
        <label class="form-label text-primary">&nbsp;</label>
        <app-button buttonType="default" text="Reinsurance Companies" data-bs-toggle="modal"
          data-bs-target="#RCompaniesModal"></app-button>
      </div>
      <div class="col-md-3">
        <label class="form-label text-primary">&nbsp;</label>
        <app-button buttonType="default" text="Link Covers" data-bs-toggle="modal" data-bs-target="#LinkCovers">
        </app-button>
      </div>
      <div class="col-md-3">
        <label class="form-label text-primary">&nbsp;</label>
        <app-button buttonType="default" text="Sliding Scale Commission" data-bs-toggle="modal"
          data-bs-target="#SlidingScaleRate">
        </app-button>
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-12 d-flex justify-content-end">
        <app-button (click)="createReinsuranceWithData()" [buttonType]="'save'"></app-button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="RCompaniesModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">
            Reinsurance Companies
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container">
            <div *ngFor="let item of reinsuranceCompanies; let i = index" class="row mb-2 align-items-end">
              <div class="col">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="" class="form-label text-primary">{{"Line No"|appTranslate|async}}</label>
                      <input type="number" [value]="item.lineNo" min="1" readonly class="form-control control-bg-gray" />
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="form-group">
                      <label for="" class="form-label text-primary">{{"Reinsurer"|appTranslate|async}}</label>
                      <select class="form-control control-bg-gray" [(ngModel)]="item.reinsCompanyId">
                        <option *ngFor="let item of reinsurerCompany" value="{{ +item.no }}">
                          {{ item.no }} - {{ item.fullName }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="" class="form-label text-primary">{{"Lower Limit"|appTranslate|async}}</label>
                      <input type="number" [(ngModel)]="item.lowerLimit" min="1" class="form-control control-bg-gray" />
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="" class="form-label text-primary">{{"Upper Limit"|appTranslate|async}}</label>
                      <input type="number" min="1" [(ngModel)]="item.upperLimit" class="form-control control-bg-gray" />
                    </div>
                  </div>
                  <div class="col">
                    <div class="form-group">
                      <label for="" class="form-label text-primary">{{"No of Lines"|appTranslate|async}}</label>
                      <input type="number" min="1" [(ngModel)]="item.noOfLines" class="form-control control-bg-gray" />
                    </div>
                  </div>
                  <div class="col-2">
                    <div class="form-group">
                      <label for="" class="form-label text-primary">{{"Companies Share (%)"|appTranslate|async}}</label>
                      <input type="number" [(ngModel)]="item.reinsCompanyShare" required min="1"
                        class="form-control control-bg-gray" />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-auto d-flex">
                <div class="me-2">
                  <app-btn type="danger-outline" [iconBtn]="true" icon="delete"
                    (mclick)="deleteReinsuranceCompanies(i)"></app-btn>
                </div>
                <app-btn type="outline" [iconBtn]="true" icon="add" (mclick)="addReinsuranceCompanies(i+1)"></app-btn>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <app-btn type="secondary"   icon="save" text="Save" (mclick)="submitReinsuranceCompanies()" data-bs-dismiss="modal">
          </app-btn>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="LinkCovers" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">{{"Link Covers"|appTranslate|async}}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>{{"Existing Products this Treaty is Linked to"|appTranslate|async}}</h6>

          <div class="row mt-4">
            <div class="col">
              <b>{{"Product Classes"|appTranslate|async}}</b>
            </div>
            <div class="col">
              <b>{{"Products "|appTranslate|async}}</b>
            </div>
            <div class="col">
              <b>{{"Cover "|appTranslate|async}}</b>
            </div>
          </div>
          <!-- <div class="row mt-2" *ngFor="let item of linkCovers">
          <div class="col">{{ item.prodClass }}</div>
          <div class="col">{{ item.productCode }}</div>
          <div class="col">{{ item.coverCode }}</div>
        </div> -->
          <div class="row mt-2">
            <hr />
          </div>
          <div class="row mt-2">
            <div class="col">{{"Link the Treaty to New Product"|appTranslate|async}}</div>
          </div>

          <div *ngFor="let item of linkCovers; let i = index" class="row mt-4 justify-content-center">
            <div class="col">
              <div class="form-group">
                <label for="" class="form-label">{{"Product / Risk Class"|appTranslate|async}}</label>
                <select [(ngModel)]="item.prodClass" (ngModelChange)="modelChangeFRiskClassValue($event)" required
                  name="prClass_{{ item.rowId }}" id="" class="form-control control-bg-gray">
                  <option *ngFor="let item of linkCoverProduct" value="{{ item.code }}">
                    {{ item.code }} - {{ item.description }}
                  </option>
                </select>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="" class="form-label">{{"Product"|appTranslate|async}}</label>
                <select [(ngModel)]="item.productCode" (ngModelChange)="modelChangeFProductValue($event)" required
                  name="product_{{ item.rowId }}" id="" class="form-control control-bg-gray">
                  <option *ngFor="let item of coverProductListClass" value="{{ item.code }}">
                    {{ item.description }}
                  </option>
                </select>
              </div>
            </div>
            <div *ngIf="item.productCode" class="col">
              <div class="form-group">
                <label for="" class="form-label">{{"Cover"|appTranslate|async}}</label>
                <select [(ngModel)]="item.coverCode" required name="coverCode_{{ item.rowId }}" id=""
                  class="form-control control-bg-gray">
                  <option *ngFor="let item of coverProductListProduct" value="{{ item.code }}">
                    {{ item.description }}
                  </option>
                </select>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="" class="form-label">&nbsp;</label>

                <app-button [buttonType]="'delete'" (click)="deleteLinkCover(i)"></app-button>
              </div>
            </div>
          </div>

          <div class="row mt-2">
            <div class="col-12 d-flex justify-content-end">
              <app-button (click)="addLinkCover()" [buttonType]="'add'"></app-button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <app-button (click)="submitProductCovers()" buttonType="save" data-bs-dismiss="modal"></app-button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="ReinsuranceBroker" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">{{"Reinsurance Broker"|appTranslate|async}}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div *ngFor="let item of reinsuranceBroker; let i = index" class="row mt-4">
            <div class="col-8">
              <div class="row">
                <div class="col-3">
                  <label class="form-label text-primary">{{"Agent No"|appTranslate|async}}</label>
                  <input [(ngModel)]="item.reinsAgentNo" type="text" min="1" required
                    class="form-control form-control-sm control-bg-gray" />
                </div>
                <div class="col-3">
                  <label class="form-label text-primary">&nbsp;</label>
                  <app-button buttonType="find"></app-button>
                </div>
                <div class="col">
                  <label class="form-label text-primary">&nbsp;</label>
                  <input type="text" class="form-control control-bg-gray" />
                </div>
              </div>

            </div>

            <div class="col">
              <label class="form-label text-primary">{{"Proportion (%)"|appTranslate|async}}</label>
              <input [(ngModel)]="item.proportion" type="number" min="1" required
                class="form-control form-control-sm control-bg-gray" />
            </div>
            <div class="col-2">
              <label class="form-label text-primary">&nbsp;</label>
              <app-button [buttonType]="'delete'" (click)="deleteReinsuranceBroker(i)"></app-button>
            </div>
          </div>
        <div class="row mt-4 mb-3 justify-content-end">
          <div class="col-3">
            <app-button (click)="addReinsuranceBroker()" buttonType="add"></app-button>
          </div>
        </div>
        </div>


        <div class="modal-footer">
          <app-button (click)="submitBroker()" buttonType="save" data-bs-dismiss="modal"></app-button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="SlidingScaleRate" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">
            Sliding Scale Commission
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mt-4">
            <div class="col-md-4">
              <label class="form-label text-primary">{{"Provisional Reinsurance Commission"|appTranslate|async}}</label>
              <input type="number" [(ngModel)]="reinsuranceData.treaty.provReinsCommRate"
                class="form-control form-control-sm control-bg-gray" />
            </div>
            <div class="col-md-4">
              <label class="form-label text-primary">{{"Terminal O/S Claim Amount"|appTranslate|async}}</label>
              <input type="number" [(ngModel)]="reinsuranceData.treaty.termOsClaimAmt"
                class="form-control form-control-sm control-bg-gray" />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <app-button buttonType="save" data-bs-dismiss="modal"></app-button>
        </div>
      </div>
    </div>
  </div>
</loader>
